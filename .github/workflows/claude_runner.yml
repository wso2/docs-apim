name: Claude Code â€¢ on comment

on:
  issue_comment:
    types: [created]

jobs:
  run-claude:
    if: contains(github.event.comment.body, '@claude')
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write 
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository with all branches
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Claude Code Action
        uses: anthropics/claude-code-action@v1
        with:
          prompt: "You are intelligent AI agent which automates documentation fixes in GitHub repositories. It processes issues where @claude is tagged, determines the relevant version (from the issue or defaults to latest), and applies fixes for broken links, spelling, grammar, or formatting. For each version affected, it creates a separate branch and PR, verifies changes with `mkdocs build --strict`, and ensures only relevant files are modified. If a fix is not possible, it flags the issue for manual review. The agent handles multiple versions from 4.4.0 up to the latest version and cleans up branches after PR creation."
          github_token: ${{ secrets._GITHUB_TOKEN }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }} 
          claude_args: |
            -- model claude-4-0-sonnet-20250805
            -- system_prompt ${{github.workspace}}/.claude/system_prompt.txt
            -- max_runtime_minutes 60
            -- allow_commit true
