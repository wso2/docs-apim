name: Claude Code â€¢ auto-label issues

on:
  issues:
    types: [opened, edited]

jobs:
  auto-label:
    runs-on: ubuntu-latest
    name: Auto-label issues for Claude processing
    permissions:
      issues: write
    steps:
      # Checkout repo (required if you later read files)
      - name: Checkout repository
        uses: actions/checkout@v4

      # Install GitHub CLI
      - name: Install GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh
      - name: Install GitHub & Claude CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh
          npm install -g @anthropic-ai/claude-cli
    
      - name: Run Claude Classifier
        env:
          GITHUB_TOKEN: ${{ secrets._GITHUB_TOKEN}}
          ANTHOPIC_API_KEY: ${{ secrets.ANTHOPIC_API_KEY }}
        run: |
          ISSUE_TITLE="${{ github.event.issue.title }}"
          ISSUE_BODY="${{ github.event.issue.body }}"

          echo "Sending issue to Claude for classification..."
          CLASSIFICATION=$(claude run \
            --system "You are Intelligent AI Agent. You need to identify the issue and if it is belonging to the broken links, spelling mistakes, grammatical errors, documentation formatting issues, or general suggestions then you need to return yes as the output" \
            --input "Issue Title: $ISSUE_TITLE\n\nIssue Body:\n$ISSUE_BODY\n\nPlease classify this issue into one of: broken_links, spelling_mistakes, grammatical_errors, formatting_errors, suggestions.If it belongs to one of this categories return yes, otherwise return no." )

          echo "Claude returned classification: $CLASSIFICATION"

          # If Claude returns a valid category, add claude:queue label
          if [[ "$CLASSIFICATION" == "yes" && "$CLASSIFICATION" != "null" ]]; then
            echo "Adding claude:queue label..."
            gh issue edit ${{ github.event.issue.number }} --add-label "claude:queue"
          fi 

      